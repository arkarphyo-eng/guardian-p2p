<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guardian P2P - Free Market Rate</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        :root { --gold: #D4AF37; --dark: #0a0a0a; --card: #161616; --safe: #2ecc71; --danger: #e74c3c; --admin: #8e44ad; }
        body { background: var(--dark); color: white; font-family: sans-serif; margin: 0; padding-bottom: 50px; display: flex; flex-direction: column; align-items: center; }
        header { width: 100%; padding: 15px; text-align: center; background: #000; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 100; }
        .container { width: 92%; max-width: 450px; margin-top: 15px; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #222; }
        h4 { margin: 0 0 10px 0; color: var(--gold); font-size: 13px; text-transform: uppercase; }
        .price-display { font-size: 38px; font-weight: bold; color: var(--gold); text-align: center; margin: 5px 0; }
        input { width: 90%; padding: 12px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #333; background: #000; color: white; }
        button { background: var(--gold); color: black; padding: 12px; border: none; border-radius: 6px; font-weight: bold; width: 100%; cursor: pointer; }
        .premium-lock { text-align: center; padding: 20px; border: 1px dashed #444; border-radius: 10px; background: #111; }
        #payment-section { display: none; margin-top: 10px; padding: 15px; background: #1a1020; border: 1px solid var(--admin); border-radius: 10px; }
        .list-item { background: #000; padding: 12px; margin-top: 10px; border-radius: 6px; border-left: 4px solid var(--danger); font-size: 12px; }
    </style>
</head>
<body>

<header>
    <div style="color:var(--gold); font-weight:bold; letter-spacing:1px;">GUARDIAN P2P</div>
</header>

<div class="container">
    <div class="card">
        <div style="text-align:center; font-size:11px; color:var(--safe);">LIVE MARKET RATE (FREE)</div>
        <div id="display-price" class="price-display">Syncing...</div>
        <div id="price-time" style="text-align:center; font-size:10px; color:#444;">Last update: --:--</div>
    </div>

    <div class="card">
        <h4>Daily History</h4>
        <div style="display:flex; justify-content:space-between; font-size:12px; color:#aaa;">
            <div>10AM: <span id="p-10am" style="color:var(--gold);">--</span></div>
            <div>1PM: <span id="p-1pm" style="color:var(--gold);">--</span></div>
            <div>5PM: <span id="p-5pm" style="color:var(--gold);">--</span></div>
        </div>
    </div>

    <div id="premium-features" style="display:none;">
        <div class="card">
            <h4>Verify Client ID</h4>
            <input type="text" id="searchKey" placeholder="Phone or Account No.">
            <button onclick="searchDB()">CHECK BLACKLIST</button>
            <div id="searchResult" style="margin-top:10px; display:none; padding:10px; border-radius:5px;"></div>
        </div>
    </div>

    <div id="activation-card" class="card premium-lock">
        <div style="font-size:14px; color:var(--gold);">PREMIUM FEATURES üîí</div>
        <p style="font-size:11px; color:#777;">Blacklist ·ÄÖ·ÄÖ·Ä∫·ÄÜ·Ä±·Ä∏·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ ·Ä°·Äû·ÄØ·Ä∂·Ä∏·Äï·Äº·ÄØ·Äõ·Äî·Ä∫ Account Activation ·Äï·Äº·ÄØ·Äú·ÄØ·Äï·Ä∫·Äï·Ä´·Åã</p>
        <button onclick="togglePayment()" style="font-size:12px; padding:8px;">GET ACCESS</button>

        <div id="payment-section">
            <p style="font-size:12px; color:#ccc; margin-bottom:10px;">·ÄÑ·ÄΩ·Ä±·Äú·ÄΩ·Äæ·Ä≤·Äï·Äº·ÄÆ·Ä∏·Äú·Äª·Äæ·ÄÑ·Ä∫ Merchant ID ·Äî·Äæ·ÄÑ·Ä∑·Ä∫ Transaction ID ·Äï·Ä±·Ä∏·Äï·Ä≠·ÄØ·Ä∑·Äï·Ä´·Åã</p>
            <div style="font-size:12px; background:#000; padding:10px; text-align:left; margin-bottom:10px; border:1px solid #333;">
                KPay: <b id="display-kpay" style="color:var(--gold);">09-xxxxxxxxx</b><br>
                Wave: <b id="display-wave" style="color:var(--gold);">09-xxxxxxxxx</b>
            </div>
            <input type="text" id="pay-mid" placeholder="Desired Merchant ID">
            <input type="text" id="pay-tx" placeholder="Transaction ID (Last 6 digits)">
            <button onclick="requestAccess()" style="background:var(--admin); color:white;">SEND REQUEST</button>
        </div>
    </div>

    <button onclick="loginAdmin()" style="background:transparent; color:#333; margin-top:30px; border:none; font-size:10px;">ADMIN LOGIN</button>
    
    <div id="admin-panel" class="card" style="display:none; border: 1px solid var(--admin);">
        <h4 style="color:var(--admin);">ADMIN DASHBOARD</h4>
        <input type="number" id="manual-price" placeholder="Set Price">
        <button onclick="updatePrice()" style="background:var(--admin); color:white; margin-bottom:20px;">SET PRICE & LOG</button>
        
        <h4 style="color:var(--admin); border-top:1px solid #333; padding-top:10px;">Update Payment Numbers</h4>
        <input type="text" id="new-kpay" placeholder="New KPay Number">
        <input type="text" id="new-wave" placeholder="New Wave Number">
        <button onclick="updatePhones()" style="background:var(--admin); color:white;">UPDATE PHONES</button>
        
        <div id="pending-list" style="margin-top:15px; font-size:12px;"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyD6-YgwUQyVVC1KaQP8a7ZriL6QyeH8H3A",
        authDomain: "guardian-p2p-b3fea.firebaseapp.com",
        projectId: "guardian-p2p-b3fea",
        storageBucket: "guardian-p2p-b3fea.firebasestorage.app",
        messagingSenderId: "412182287726",
        appId: "1:412182287726:web:84c2e20ce368aeb393dd7f",
        databaseURL: "https://guardian-p2p-b3fea-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentMID = localStorage.getItem('g_mid');
    let isAdmin = false;

    // ·ÅÅ·Åã ·ÄÑ·ÄΩ·Ä±·Äú·ÄΩ·Äæ·Ä≤·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫·Äô·Äª·Ä¨·Ä∏·ÄÄ·Ä≠·ÄØ Database ·Äô·Äæ ·ÄÜ·ÄΩ·Ä≤·Äë·ÄØ·Äê·Ä∫·Äï·Äº·Äû·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
    db.ref('settings/').on('value', snap => {
        const val = snap.val();
        if(val) {
            if(val.kpay) document.getElementById('display-kpay').innerText = val.kpay;
            if(val.wave) document.getElementById('display-wave').innerText = val.wave;
        }
    });

    // ·ÅÇ·Åã Admin ·Äô·Äæ ·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
    function updatePhones() {
        const k = document.getElementById('new-kpay').value;
        const w = document.getElementById('new-wave').value;
        if(!isAdmin) return alert("Admin Login ·Äù·ÄÑ·Ä∫·Äï·Ä´·Åã");
        if(k) db.ref('settings/kpay').set(k);
        if(w) db.ref('settings/wave').set(w);
        alert("·Äñ·ÄØ·Äî·Ä∫·Ä∏·Äî·Ä∂·Äï·Ä´·Äê·Ä∫·Äô·Äª·Ä¨·Ä∏ ·Äï·Äº·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏·Äú·Ä≤·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã");
    }

    // ·Äà·Ä±·Ä∏·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏ Sync ·Äú·ÄØ·Äï·Ä∫·ÄÅ·Äº·ÄÑ·Ä∫·Ä∏
    db.ref('market_price/').on('value', snap => {
        const val = snap.val();
        if(val) {
            document.getElementById('display-price').innerText = parseInt(val.rate).toLocaleString() + " MMK";
            document.getElementById('price-time').innerText = "Update: " + val.time;
        }
    });

    const today = new Date().toISOString().split('T')[0];
    db.ref('daily_logs/' + today).on('value', snap => {
        const d = snap.val() || {};
        document.getElementById('p-10am').innerText = d.t10 ? parseInt(d.t10).toLocaleString() : "--";
        document.getElementById('p-1pm').innerText = d.t13 ? parseInt(d.t13).toLocaleString() : "--";
        document.getElementById('p-5pm').innerText = d.t17 ? parseInt(d.t17).toLocaleString() : "--";
    });

    function checkAccess() {
        if(!currentMID) return;
        db.ref('users/' + currentMID).on('value', snap => {
            if(snap.val() && snap.val().active) {
                document.getElementById('premium-features').style.display = 'block';
                document.getElementById('activation-card').style.display = 'none';
            }
        });
    }

    function togglePayment() { document.getElementById('payment-section').style.display = 'block'; }

    function requestAccess() {
        const mid = document.getElementById('pay-mid').value;
        const tx = document.getElementById('pay-tx').value;
        if(mid && tx) {
            db.ref('users/' + mid).set({ active: false, pending: true, tx: tx });
            localStorage.setItem('g_mid', mid);
            alert("Request ·Äï·Ä≠·ÄØ·Ä∑·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã Admin ·Ä°·Äê·Ää·Ä∫·Äï·Äº·ÄØ·ÄÅ·Äª·ÄÄ·Ä∫·ÄÄ·Ä≠·ÄØ ·ÄÖ·Ä±·Ä¨·ÄÑ·Ä∑·Ä∫·Äï·Ä´·Åã");
        }
    }

    function loginAdmin() {
        if(prompt("Admin Password:") === "151015") {
            isAdmin = true;
            document.getElementById('admin-panel').style.display = 'block';
            loadRequests();
        }
    }

    function loadRequests() {
        db.ref('users/').on('value', snap => {
            const list = document.getElementById('pending-list');
            list.innerHTML = "<b>Pending Requests:</b>";
            snap.forEach(c => {
                if(c.val().pending) {
                    list.innerHTML += `<div class='list-item'>ID: ${c.key} (TX: ${c.val().tx}) 
                    <button onclick="approveUser('${c.key}')" style="background:var(--safe); width:auto; padding:2px 5px; font-size:10px;">APPROVE</button></div>`;
                }
            });
        });
    }

    function approveUser(id) { db.ref('users/' + id).update({ active: true, pending: false }); }

    function updatePrice() {
        const p = document.getElementById('manual-price').value;
        if(!isAdmin || !p) return;
        const now = new Date();
        const hour = now.getHours();
        db.ref('market_price/').set({ rate: p, time: now.toLocaleTimeString() });
        let skey = hour < 12 ? 't10' : (hour < 15 ? 't13' : 't17');
        db.ref('daily_logs/' + today).update({ [skey]: p });
        alert("·Äà·Ä±·Ä∏·Äî·Äæ·ÄØ·Äî·Ä∫·Ä∏·Äï·Äº·ÄÑ·Ä∫·ÄÜ·ÄÑ·Ä∫·Äï·Äº·ÄÆ·Ä∏·Äï·Ä´·Äï·Äº·ÄÆ·Åã");
    }

    function searchDB() {
        const key = document.getElementById('searchKey').value;
        const res = document.getElementById('searchResult');
        res.style.display = 'block'; res.innerHTML = "Searching...";
        db.ref('incidents/').once('value', snap => {
            let found = false;
            snap.forEach(c => { if(c.val().target.includes(key)) { res.innerHTML = "‚úñ SCAMMER MATCH!"; res.style.color = "red"; found = true; } });
            if(!found) { res.innerHTML = "‚úî CLEAR"; res.style.color = "green"; }
        });
    }

    checkAccess();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guardian P2P - Ultimate</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        :root { --gold: #D4AF37; --dark: #0a0a0a; --card: #161616; --safe: #2ecc71; --danger: #e74c3c; --admin: #8e44ad; }
        body { background: var(--dark); color: white; font-family: sans-serif; margin: 0; padding-bottom: 80px; display: flex; flex-direction: column; align-items: center; }
        header { width: 100%; padding: 15px; text-align: center; background: #000; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 100; }
        .container { width: 92%; max-width: 450px; margin-top: 15px; }
        .card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 15px; border: 1px solid #222; }
        .price-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .price-box { text-align: center; padding: 10px; border-radius: 8px; border: 1px solid #333; }
        .buy { color: var(--safe); border-color: var(--safe); }
        .sell { color: var(--danger); border-color: var(--danger); }
        .price-val { font-size: 24px; font-weight: bold; display: block; }
        input { width: 90%; padding: 12px; margin-bottom: 10px; border-radius: 6px; border: 1px solid #333; background: #000; color: white; }
        button { background: var(--gold); color: black; padding: 12px; border: none; border-radius: 6px; font-weight: bold; width: 100%; cursor: pointer; }
        .hidden { display: none; }
        .daily-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; text-align: center; font-size: 11px; margin-top: 10px; }
        .status-badge { padding: 2px 8px; border-radius: 10px; font-size: 10px; }
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #000; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid var(--gold); }
    </style>
</head>
<body>

<header>
    <div style="color:var(--gold); font-weight:bold; letter-spacing:1px;">GUARDIAN P2P</div>
</header>

<div class="container">
    <div id="auth-section">
        <div class="card" id="login-box">
            <h4 style="color:var(--gold);">LOGIN</h4>
            <input type="text" id="l-phone" placeholder="Phone (09...)">
            <input type="password" id="l-pass" placeholder="6-Digit Password">
            <button onclick="handleLogin()">LOGIN</button>
            <p style="font-size:11px; text-align:center;" onclick="toggleAuth(true)">New here? <span style="color:var(--gold);">Sign Up</span></p>
        </div>

        <div class="card hidden" id="signup-box">
            <h4 style="color:var(--gold);">SIGN UP</h4>
            <input type="text" id="s-phone" placeholder="Phone (09...)">
            <input type="text" id="s-nick" placeholder="Nickname">
            <input type="password" id="s-pass" placeholder="6-Digit Password" maxlength="6">
            <button onclick="handleSignup()">CREATE ACCOUNT</button>
            <p style="font-size:11px; text-align:center;" onclick="toggleAuth(false)">Back to <span style="color:var(--gold);">Login</span></p>
        </div>
    </div>

    <div id="main-content" class="hidden">
        <div class="card" style="border-left: 4px solid var(--gold);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h3 id="user-name" style="margin:0;">User</h3>
                    <span id="user-status" class="status-badge" style="background:#333;">Free User</span>
                </div>
                <button onclick="logout()" style="width:auto; padding:5px 10px; font-size:10px; background:#222; color:white;">Logout</button>
            </div>
        </div>

        <div class="card">
            <h4 style="margin:0; font-size:11px; color:var(--gold); text-align:center;">LIVE MARKET RATE</h4>
            <div class="price-grid">
                <div class="price-box buy">
                    <span style="font-size:9px;">BUY (·Ä°·Äù·Äö·Ä∫)</span>
                    <span id="buy-rate" class="price-val">0</span>
                </div>
                <div class="price-box sell">
                    <span style="font-size:9px;">SELL (·Ä°·Äõ·Ä±·Ä¨·ÄÑ·Ä∫·Ä∏)</span>
                    <span id="sell-rate" class="price-val">0</span>
                </div>
            </div>
            <div class="daily-grid">
                <div class="card" style="padding:5px; margin:0;">10 AM<br><b id="rec-10am">--</b></div>
                <div class="card" style="padding:5px; margin:0;">1 PM<br><b id="rec-1pm">--</b></div>
                <div class="card" style="padding:5px; margin:0;">5 PM<br><b id="rec-5pm">--</b></div>
            </div>
            <div id="price-time" style="text-align:center; font-size:9px; color:#444; margin-top:5px;">Update: --:--</div>
        </div>

        <div id="premium-tools" class="hidden">
            <div class="card">
                <h4 style="color:var(--danger);">SCAM CHECKER</h4>
                <input type="text" id="scam-key" placeholder="Phone or Bank Account No.">
                <button onclick="checkScam()">CHECK NOW</button>
                <div id="scam-result" style="margin-top:10px; padding:10px; border-radius:8px; display:none; font-size:12px;"></div>
            </div>
            <div class="card">
                <h4>REPORT SCAM</h4>
                <input type="text" id="report-target" placeholder="Phone/Bank No. to report">
                <input type="text" id="report-detail" placeholder="Detail (e.g. Third Party)">
                <button onclick="submitReport()" style="background:var(--danger); color:white;">SUBMIT REPORT</button>
            </div>
        </div>

        <div id="payment-box" class="card">
            <h4 style="color:var(--gold);">UPGRADE TO PREMIUM üîí</h4>
            <div style="font-size:12px; margin-bottom:10px;">KPay/Wave: <b id="display-payno">Loading...</b></div>
            <input type="text" id="tx-id" placeholder="Transaction Last 6 digits">
            <button onclick="sendProof()">SUBMIT PAYMENT PROOF</button>
        </div>
    </div>

    <div id="admin-panel" class="hidden admin-only" style="border: 1px solid var(--admin); padding: 15px; background: #1a1020; border-radius: 12px;">
        <h4 style="color:var(--admin);">ADMIN CONTROL</h4>
        <input type="number" id="adm-buy" placeholder="New Buy Rate">
        <input type="number" id="adm-sell" placeholder="New Sell Rate">
        <button onclick="updateMarket()" style="background:var(--admin); color:white;">UPDATE MARKET</button>
        <hr style="border:0.5px solid #333; margin:15px 0;">
        <div id="admin-req-list"></div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyD6-YgwUQyVVC1KaQP8a7ZriL6QyeH8H3A",
        authDomain: "guardian-p2p-b3fea.firebaseapp.com",
        projectId: "guardian-p2p-b3fea",
        storageBucket: "guardian-p2p-b3fea.firebasestorage.app",
        messagingSenderId: "412182287726",
        appId: "1:412182287726:web:84c2e20ce368aeb393dd7f",
        databaseURL: "https://guardian-p2p-b3fea-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let currentPhone = localStorage.getItem('user_ph');

    // 1. Auth Logic
    function toggleAuth(showSignup) {
        document.getElementById('login-box').classList.toggle('hidden', showSignup);
        document.getElementById('signup-box').classList.toggle('hidden', !showSignup);
    }

    function handleSignup() {
        const ph = document.getElementById('s-phone').value;
        const nk = document.getElementById('s-nick').value;
        const ps = document.getElementById('s-pass').value;
        if(ph.startsWith('09') && ps.length == 6 && nk) {
            db.ref('users/' + ph).set({ nick: nk, pass: ps, active: false }).then(() => {
                alert("Account created! Please Login.");
                toggleAuth(false);
            });
        } else { alert("Please fill all correctly (Pass: 6 digits)"); }
    }

    function handleLogin() {
        const ph = document.getElementById('l-phone').value;
        const ps = document.getElementById('l-pass').value;

        if(ph === "admin@gmail.com" && ps === "151015") {
            if(prompt("Admin Code:") === "151015") {
                document.getElementById('admin-panel').classList.remove('hidden');
                loadAdminData();
                return;
            }
        }

        db.ref('users/' + ph).once('value', snap => {
            const u = snap.val();
            if(u && u.pass === ps) {
                localStorage.setItem('user_ph', ph);
                location.reload();
            } else { alert("Invalid login!"); }
        });
    }

    // 2. App Logic
    if(currentPhone) {
        document.getElementById('auth-section').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        
        db.ref('users/' + currentPhone).on('value', snap => {
            const u = snap.val();
            document.getElementById('user-name').innerText = u.nick;
            if(u.active) {
                document.getElementById('user-status').innerText = "Premium Member";
                document.getElementById('user-status').style.background = "var(--gold)";
                document.getElementById('premium-tools').classList.remove('hidden');
                document.getElementById('payment-box').classList.add('hidden');
            }
        });
    }

    // 3. Market Rates Sync
    db.ref('market_rates/').on('value', snap => {
        const d = snap.val() || {buy: 0, sell: 0, time: '--'};
        document.getElementById('buy-rate').innerText = parseInt(d.buy).toLocaleString();
        document.getElementById('sell-rate').innerText = parseInt(d.sell).toLocaleString();
        document.getElementById('price-time').innerText = "Update: " + d.time;
    });

    const today = new Date().toISOString().split('T')[0];
    db.ref('daily_records/' + today).on('value', snap => {
        const d = snap.val() || {};
        document.getElementById('rec-10am').innerText = d.t10 || "--";
        document.getElementById('rec-1pm').innerText = d.t13 || "--";
        document.getElementById('rec-5pm').innerText = d.t17 || "--";
    });

    // 4. Scam Check Logic
    function checkScam() {
        const key = document.getElementById('scam-key').value;
        const res = document.getElementById('scam-result');
        res.style.display = 'block'; res.style.background = "#111";
        db.ref('scams/').once('value', snap => {
            let found = null;
            snap.forEach(c => { if(c.key === key) found = c.val(); });
            if(found) {
                res.innerHTML = `<b style="color:var(--danger);">‚úñ SCAMMER DETECTED</b><br>Detail: ${found.detail}`;
                res.style.border = "1px solid var(--danger)";
            } else {
                res.innerHTML = `<b style="color:var(--safe);">‚úî CLEAR / NOT FOUND</b><br>Safe to trade.`;
                res.style.border = "1px solid var(--safe)";
            }
        });
    }

    function submitReport() {
        const t = document.getElementById('report-target').value;
        const d = document.getElementById('report-detail').value;
        if(t && d) {
            db.ref('scams/' + t).set({ detail: d, by: currentPhone });
            alert("Report submitted.");
        }
    }

    // Admin Functions
    function updateMarket() {
        const b = document.getElementById('adm-buy').value;
        const s = document.getElementById('adm-sell').value;
        const hr = new Date().getHours();
        db.ref('market_rates/').set({ buy: b, sell: s, time: new Date().toLocaleTimeString() });
        let key = hr < 12 ? 't10' : (hr < 15 ? 't13' : 't17');
        db.ref('daily_records/' + today).update({ [key]: b });
    }

    function loadAdminData() {
        db.ref('requests/').on('value', snap => {
            const list = document.getElementById('admin-req-list');
            list.innerHTML = "<h5>Pending Access</h5>";
            snap.forEach(c => {
                list.innerHTML += `<div class='card' style='font-size:11px;'>ID: ${c.key} (TX: ${c.val().tx}) 
                <button onclick="approve('${c.key}')" style='background:var(--safe); width:auto; padding:2px 5px;'>Approve</button></div>`;
            });
        });
    }

    function approve(id) { db.ref('users/' + id).update({ active: true }); db.ref('requests/' + id).remove(); }
    function logout() { localStorage.clear(); location.reload(); }
    function sendProof() {
        const tx = document.getElementById('tx-id').value;
        if(tx) { db.ref('requests/' + currentPhone).set({ tx: tx }); alert("Proof sent!"); }
    }
    
    db.ref('settings/').on('value', s => { 
        const v = s.val(); 
        document.getElementById('display-payno').innerText = v ? `KPay: ${v.kpay} / Wave: ${v.wave}` : "09-xxxxxxxxx"; 
    });
</script>
</body>
</html>
